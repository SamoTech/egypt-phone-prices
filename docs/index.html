<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª ÙÙŠ Ù…ØµØ± - Ø£ÙØ¶Ù„ Ù…Ù‚Ø§Ø±Ù†Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Ù‚Ø§Ø±Ù† Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª ÙÙŠ Ù…ØµØ± Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„ÙƒØ¨ÙŠØ±Ø©ØŒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø³Ø¹Ø± Ù…Ø¹ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù‡Ø¨ÙˆØ·." />
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#111827" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background: #0f172a; color: #e5e7eb; line-height: 1.5; }
    header { padding: 1rem; background: #020617; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid #1f2937; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    h1 { font-size: 1.875rem; margin-bottom: 1rem; color: #f0f9ff; }
    .search-row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    input, select { padding: 0.75rem; border-radius: 0.375rem; border: 1px solid #334155; background: #1e293b; color: #e5e7eb; font: inherit; }
    input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
    .filter-buttons { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
    button { padding: 0.5rem 1rem; border-radius: 0.375rem; border: none; background: #1d4ed8; color: white; font-size: 0.875rem; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1e40af; }
    button.secondary { background: #1e293b; }
    button.secondary:hover { background: #334155; }
    button.active { background: #10b981; }
    #stats { font-size: 0.875rem; color: #9ca3af; margin-bottom: 0.5rem; }
    .phones-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem; }
    .card { background: #020617; border-radius: 0.75rem; border: 1px solid #1f2937; padding: 1rem; display: flex; flex-direction: column; gap: 0.75rem; transition: border-color 0.2s; }
    .card:hover { border-color: #3b82f6; }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 0.5rem; }
    .card-title { font-weight: 600; color: #f0f9ff; font-size: 0.95rem; }
    .card-subtitle { font-size: 0.75rem; color: #9ca3af; }
    .tag { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; background: #1e293b; }
    .tag.flagship { background: #7c3aed; color: #fce7f3; }
    .tag.upper_mid { background: #0891b2; color: #cffafe; }
    .tag.mid { background: #7c3aed; }
    .tag.budget { background: #059669; }
    .tag.ultra_budget { background: #ea580c; }
    .price-line { font-weight: 700; color: #22c55e; font-size: 1.125rem; display: flex; justify-content: space-between; align-items: center; }
    .store-pill { display: inline-block; font-size: 0.7rem; background: #1e293b; padding: 0.25rem 0.5rem; border-radius: 999px; margin-inline-start: 0.5rem; }
    .spec-line { font-size: 0.8rem; color: #9ca3af; }
    .card-bottom { display: flex; justify-content: space-between; align-items: center; gap: 0.5rem; }
    .availability { font-size: 0.75rem; color: #9ca3af; }
    .card-buttons { display: flex; gap: 0.5rem; }
    .card-buttons button { padding: 0.375rem 0.75rem; font-size: 0.75rem; }
    .list-view .phones-grid { grid-template-columns: 1fr; }
    .list-view .card { flex-direction: row; align-items: center; }
    .list-view .card-title { flex: 1; }
    .comparison-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #020617; border-top: 1px solid #1f2937; padding: 1rem; display: none; justify-content: space-between; align-items: center; }
    .comparison-bar.show { display: flex; }
    .comparison-list { flex: 1; display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .chip { background: #1e293b; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; }
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #020617; border-top: 1px solid #1f2937; display: flex; justify-content: space-around; padding: 0.5rem 0; z-index: 5; }
    .bottom-nav button { width: 100%; border-radius: 0; background: transparent; color: #9ca3af; }
    .bottom-nav button.active { color: #3b82f6; }
    @media (max-width: 768px) {
      .search-row { flex-direction: column; }
      input, select { width: 100%; }
      .phones-grid { grid-template-columns: 1fr; }
      body { padding-bottom: 4rem; }
    }
  </style>
</head>
<body>
<header>
  <div class="container">
    <h1>ğŸ‡ªğŸ‡¬ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„Ø§Øª ÙÙŠ Ù…ØµØ±</h1>
    <div class="search-row">
      <input id="searchInput" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ / Ø§Ù„Ù…Ø§Ø±ÙƒØ©..." />
      <select id="brandFilter">
        <option value="">ÙƒÙ„ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª</option>
      </select>
      <select id="segmentFilter">
        <option value="">ÙƒÙ„ Ø§Ù„ÙØ¦Ø§Øª</option>
        <option value="flagship">ÙÙ„Ø§Ø¬Ø´ÙŠØ¨</option>
        <option value="upper_mid">ÙØ¦Ø© ÙÙˆÙ‚ Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</option>
        <option value="mid">ÙØ¦Ø© Ù…ØªÙˆØ³Ø·Ø©</option>
        <option value="budget">Ø§Ù‚ØªØµØ§Ø¯ÙŠ</option>
        <option value="ultra_budget">ØªØ­Øª 5000</option>
      </select>
      <select id="sortSelect">
        <option value="lowest_price_asc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„</option>
        <option value="lowest_price_desc">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
        <option value="name_asc">Ø§Ù„Ø§Ø³Ù… A-Z</option>
      </select>
      <button id="viewToggle" class="secondary">Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>
  </div>
</header>

<main class="container">
  <div id="stats"></div>
  <div class="filter-buttons">
    <button class="secondary" data-filter="5g">ÙŠØ¯Ø¹Ù… 5G</button>
    <button class="secondary" data-filter="ram">Ø±Ø§Ù… 8GB+</button>
  </div>
  <div id="phonesWrapper">
    <div class="phones-grid" id="phonesGrid"></div>
  </div>
</main>

<div class="comparison-bar" id="comparisonBar">
  <div class="comparison-list" id="comparisonList"></div>
  <button id="openComparison">Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¢Ù†</button>
</div>

<nav class="bottom-nav">
  <button class="active">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button>Ø¹Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
  <button>Ø§ØªØµÙ„ Ø¨Ù†Ø§</button>
</nav>

<script>
let phones = [];
let storesMeta = {};
let listView = false;
let filters = { text: "", brand: "", segment: "", fiveG: false, minRam: 0 };
let sortMode = "lowest_price_asc";
let comparison = [];

async function loadData() {
  try {
    const [phonesRes, storesRes] = await Promise.all([
      fetch("phones.json"),
      fetch("stores.json")
    ]);
    if (!phonesRes.ok || !storesRes.ok) throw new Error("Failed to load data");
    phones = await phonesRes.json();
    storesMeta = await storesRes.json();
    initBrandFilter();
    render();
  } catch (err) {
    document.getElementById("stats").textContent = "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø­Ø§ÙˆÙ„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.";
    console.error(err);
  }
}

function initBrandFilter() {
  const brands = [...new Set(phones.map(p => p.brand).filter(Boolean))].sort();
  const sel = document.getElementById("brandFilter");
  brands.forEach(b => {
    const opt = document.createElement("option");
    opt.value = b;
    opt.textContent = b;
    sel.appendChild(opt);
  });
}

function filterPhones() {
  return phones.filter(p => {
    if (filters.text) {
      const t = filters.text.toLowerCase();
      const combined = (p.brand + " " + p.model + " " + (p.model_ar || "")).toLowerCase();
      if (!combined.includes(t)) return false;
    }
    if (filters.brand && p.brand !== filters.brand) return false;
    if (filters.segment && p.price_segment !== filters.segment) return false;
    if (filters.fiveG && p["5g_support"] !== "Yes") return false;
    return true;
  });
}

function sortPhones(list) {
  return list.sort((a, b) => {
    const pa = parseFloat(a.lowest_price || "0") || 0;
    const pb = parseFloat(b.lowest_price || "0") || 0;
    if (sortMode === "lowest_price_asc") return pa - pb;
    if (sortMode === "lowest_price_desc") return pb - pa;
    if (sortMode === "name_asc") return (a.brand + a.model).localeCompare(b.brand + b.model);
    return 0;
  });
}

function render() {
  const filtered = sortPhones(filterPhones());
  const grid = document.getElementById("phonesGrid");
  grid.innerHTML = "";
  document.getElementById("stats").textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù‡ÙˆØ§ØªÙ: ${filtered.length} / ${phones.length}`;

  filtered.forEach(p => {
    const card = document.createElement("article");
    card.className = "card";

    const header = document.createElement("div");
    header.className = "card-header";

    const titleDiv = document.createElement("div");
    titleDiv.innerHTML = `<div class="card-title">${p.brand} ${p.model}</div><div class="card-subtitle">${p.model_ar || ""}</div>`;
    header.appendChild(titleDiv);

    const seg = document.createElement("span");
    seg.className = `tag ${p.price_segment}`;
    seg.textContent = segmentLabel(p.price_segment);
    header.appendChild(seg);

    card.appendChild(header);

    const priceLine = document.createElement("div");
    priceLine.className = "price-line";
    if (p.lowest_price) {
      const priceDiv = document.createElement("div");
      priceDiv.textContent = `${p.lowest_price} Ø¬Ù†ÙŠÙ‡`;
      const storeDiv = document.createElement("div");
      storeDiv.className = "store-pill";
      storeDiv.textContent = p.best_store ? (storesMeta[p.best_store]?.short_name || p.best_store) : "";
      priceLine.appendChild(priceDiv);
      priceLine.appendChild(storeDiv);
    } else {
      priceLine.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¹Ø§Ø±";
    }
    card.appendChild(priceLine);

    const specLine = document.createElement("div");
    specLine.className = "spec-line";
    specLine.textContent = `${p.display_size || ""} â€¢ ${p.ram || ""} â€¢ ${p.storage || ""}`;
    card.appendChild(specLine);

    const bottom = document.createElement("div");
    bottom.className = "card-bottom";

    const avail = document.createElement("div");
    avail.className = "availability";
    avail.textContent = `${p.availability_score || 0} Ù…ØªØ§Ø¬Ø±`;
    bottom.appendChild(avail);

    const btns = document.createElement("div");
    btns.className = "card-buttons";
    const cmpBtn = document.createElement("button");
    cmpBtn.textContent = "Ù…Ù‚Ø§Ø±Ù†Ø©";
    cmpBtn.classList.add("secondary");
    cmpBtn.onclick = () => toggleCompare(p.id);
    btns.appendChild(cmpBtn);

    const detBtn = document.createElement("button");
    detBtn.textContent = "Ø§Ù„ØªÙØ§ØµÙŠÙ„";
    detBtn.onclick = () => showDetails(p);
    btns.appendChild(detBtn);

    bottom.appendChild(btns);
    card.appendChild(bottom);

    grid.appendChild(card);
  });

  document.getElementById("phonesWrapper").classList.toggle("list-view", listView);
  renderComparisonBar();
}

function segmentLabel(seg) {
  const labels = {
    flagship: "ÙÙ„Ø§Ø¬Ø´ÙŠØ¨",
    upper_mid: "ÙØ¦Ø© ÙÙˆÙ‚ Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©",
    mid: "Ù…ØªÙˆØ³Ø·",
    budget: "Ø§Ù‚ØªØµØ§Ø¯ÙŠ",
    ultra_budget: "Ø£Ù‚Ù„ Ù…Ù† 5000"
  };
  return labels[seg] || seg;
}

function toggleCompare(id) {
  const idx = comparison.indexOf(id);
  if (idx >= 0) comparison.splice(idx, 1);
  else if (comparison.length < 4) comparison.push(id);
  renderComparisonBar();
}

function renderComparisonBar() {
  const bar = document.getElementById("comparisonBar");
  const list = document.getElementById("comparisonList");
  if (!comparison.length) {
    bar.classList.remove("show");
    return;
  }
  bar.classList.add("show");
  list.innerHTML = "Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø©: ";
  comparison.forEach(id => {
    const p = phones.find(x => x.id === id);
    if (!p) return;
    const chip = document.createElement("span");
    chip.className = "chip";
    chip.textContent = `${p.brand} ${p.model}`;
    list.appendChild(chip);
  });
}

function showDetails(phone) {
  const details = [
    `${phone.brand} ${phone.model}`,
    `${phone.model_ar || ""}`,
    `---`,
    `Ø§Ù„Ø³Ø¹Ø±: ${phone.lowest_price || "ØºÙŠØ± Ù…ØªÙˆÙØ±"} Ø¬Ù†ÙŠÙ‡`,
    `Ø£ÙØ¶Ù„ Ù…ØªØ¬Ø±: ${storesMeta[phone.best_store]?.name || phone.best_store || "N/A"}`,
    `Ù…ØªØ§Ø­ ÙÙŠ: ${phone.availability_score || 0} Ù…ØªØ¬Ø±`,
    `---`,
    `Ø§Ù„Ø´Ø§Ø´Ø©: ${phone.display_size || ""} ${phone.display_type || ""}`,
    `Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬: ${phone.processor || ""}`,
    `Ø§Ù„Ø±Ø§Ù…: ${phone.ram || ""}`,
    `Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${phone.storage || ""}`,
    `Ø§Ù„Ø¨Ø·Ø§Ø±ÙŠØ©: ${phone.battery_capacity || ""}mAh`,
    `Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©: ${phone.rear_camera_main || ""}MP`,
    `Ø§Ù„Ù†Ø¸Ø§Ù…: ${phone.operating_system || ""} ${phone.os_version || ""}`
  ];
  alert(details.filter(d => d && d !== "---").join("\n"));
}

document.getElementById("searchInput").addEventListener("input", e => {
  filters.text = e.target.value.trim();
  render();
});

document.getElementById("brandFilter").addEventListener("change", e => {
  filters.brand = e.target.value;
  render();
});

document.getElementById("segmentFilter").addEventListener("change", e => {
  filters.segment = e.target.value;
  render();
});

document.getElementById("sortSelect").addEventListener("change", e => {
  sortMode = e.target.value;
  render();
});

document.getElementById("viewToggle").addEventListener("click", () => {
  listView = !listView;
  document.getElementById("viewToggle").textContent = listView ? "Ø¹Ø±Ø¶ ÙƒØ±ÙˆØª" : "Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø©";
  render();
});

document.querySelectorAll(".filter-buttons button").forEach(btn => {
  btn.addEventListener("click", () => {
    if (btn.dataset.filter === "5g") {
      filters.fiveG = !filters.fiveG;
    }
    btn.classList.toggle("active", filters.fiveG);
    render();
  });
});

document.getElementById("openComparison").addEventListener("click", () => {
  if (!comparison.length) return;
  const selected = phones.filter(p => comparison.includes(p.id));
  let text = "Ù…Ù‚Ø§Ø±Ù†Ø©:\n\n";
  selected.forEach(p => {
    text += `${p.brand} ${p.model}\nØ§Ù„Ø³Ø¹Ø±: ${p.lowest_price || "N/A"} Ø¬Ù†ÙŠÙ‡\nØ§Ù„Ø´Ø§Ø´Ø©: ${p.display_size || ""}\nØ§Ù„Ø±Ø§Ù…: ${p.ram || ""}\n\n`;
  });
  alert(text);
});

loadData();
</script>
</body>
</html>
